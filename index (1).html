<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>CodePen - A Pen by Mini Clipador RP</title>
    

  </head>
    
  <body>
  <!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Raspaquinasorte — Realista</title>
<style>
  :root{
    --bg:#0b1220; --panel:#0f1724; --accent:#12b76a; --accent2:#10b981; --danger:#e53935; --muted:#9aa4ad;
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0}
  body{background:var(--bg);color:#fff}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:linear-gradient(90deg,#071021, #0b1220)}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#0fbc7c,#0bb37a);display:flex;align-items:center;justify-content:center;font-weight:800;color:#052118}
  header h1{font-size:18px}
  header .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:8px;color:#fff;cursor:pointer}
  .container{max-width:1100px;margin:20px auto;padding:0 16px;display:grid;grid-template-columns:1fr 340px;gap:18px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:14px}
  .small{font-size:13px;color:var(--muted)}
  .winners{max-height:260px;overflow:auto}
  .winner{display:flex;gap:12px;align-items:center;padding:10px;border-bottom:1px solid rgba(255,255,255,0.02)}
  .winner .avatar{width:56px;height:40px;background:#0b1220;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700}
  .games{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
  .game{background:#071725;padding:12px;border-radius:8px;text-align:center}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .btn{background:linear-gradient(180deg,#0ea5a3,#0d9488);border:none;padding:8px 10px;border-radius:8px;color:#022;cursor:pointer}
  .btn-danger{background:var(--danger);color:#fff}
  .balance{font-weight:700;margin-top:10px}
  .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);visibility:hidden;opacity:0;transition:all .18s}
  .modal.active{visibility:visible;opacity:1}
  .modal-box{width:360px;background:#0b1220;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  .tabs{display:flex;gap:8px;margin-bottom:10px}
  .tab{flex:1;padding:8px;border-radius:8px;text-align:center;background:rgba(255,255,255,0.02);cursor:pointer}
  .tab.active{background:linear-gradient(90deg,#10b981,#0ea5a3);color:#022}
  .amounts{display:flex;gap:8px;margin-top:8px}
  .amount{flex:1;padding:8px;border-radius:8px;background:#071725;text-align:center;cursor:pointer}
  input[type="text"], input[type="number"]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#071725;color:#fff;margin-top:8px}
  .row{display:flex;gap:8px}
  .row .col{flex:1}
  .transactions{max-height:120px;overflow:auto;margin-top:8px;font-size:13px}
  .admin-card{margin-top:12px}
  @media(max-width:980px){ .container{grid-template-columns:1fr} .modal-box{width:92%} .games{grid-template-columns:repeat(2,1fr)} }
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo">R</div>
    <div>
      <h1>SURPRESA PREMIADA•</h1>
      <div class="small">Aposte com Responsabilidade!</div>
    </div>
  </div>
  <div style="display:flex;gap:10px;align-items:center">
    <button class="btn-ghost" id="openDepositBtn">Depositar</button>
    <button class="btn-ghost" id="openLoginBtn">Login</button>
  </div>
</header>

<!-- MAIN -->
<div class="container" id="mainWrapper">
  <!-- LEFT (conteúdo) -->
  <div>
    <div class="card">
      <h3>Últimos ganhadores</h3>
      <div class="winners" id="winnersList">
        <!-- preenchido por JS -->
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Destaques</h3>
      <div class="games" id="gamesGrid">
        <!-- cards de jogos -->
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h3>Raspadinha </h3>
      <div style="display:flex;gap:12px;align-items:center">
        <div style="flex:0 0 180px">
          <div style="background:#f3f4f6;color:#111;padding:12px;border-radius:8px;text-align:center">PARABÉNS!<br><strong id="ticketPrize">R$ 50</strong></div>
        </div>
        <div style="flex:1">
          <div class="small">Arraste na camada cinza para revelar</div>
          <canvas id="scratchCanvas" style="width:100%;height:80px;margin-top:8px;border-radius:8px;"></canvas>
          <div style="margin-top:8px" class="controls">
            <button class="btn" id="resetScratch">Resetar camada</button>
            <button class="btn" id="playRasp">Jogar (R$ 10)</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- RIGHT (painel lateral) -->
  <aside>
    <div class="card">
      <h3>Saque rápido</h3>
      <div class="small"> escolha um valor </div>
      <div class="controls" style="margin-top:10px">
        <button class="btn" onclick="quickDeposit(20)">R$ 20</button>
        <button class="btn" onclick="quickDeposit(50)">R$ 50</button>
        <button class="btn" onclick="quickDeposit(100)">R$ 100</button>
        <button class="btn btn-danger" onclick="withdrawFlow()">Sacar</button>
      </div>
      <div class="balance" id="balanceDisplay">Saldo: R$ 0.00</div>

      <div style="margin-top:12px">
        <strong class="small">Extrato</strong>
        <div class="transactions" id="transactionsList"></div>
      </div>
    </div>

    <!-- Painel Admin será injetado aqui quando admin -->
    <div id="adminContainer"></div>
  </aside>
</div>

<!-- Modal Depósito -->
<div class="modal" id="depositModal">
  <div class="modal-box">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">Depósito</h3>
      <button class="btn-ghost" id="closeDeposit">X</button>
    </div>

    <div class="tabs" style="margin-top:12px">
      <div class="tab active" data-method="pix">PIX</div>
      <div class="tab" data-method="card">Cartão</div>
    </div>

    <input type="number" id="depositAmt" placeholder="Digite o valor do depósito (R$)" max="2000" />

    <div class="amounts">
      <div class="amount" onclick="setDeposit(20)">R$ 20</div>
      <div class="amount" onclick="setDeposit(50)">R$ 50</div>
      <div class="amount" onclick="setDeposit(100)">R$ 100</div>
      <div class="amount" onclick="setDeposit(200)">R$ 200</div>
    </div>

    <!-- Campos do cartão (aparecem quando selecionado cartão) -->
    <div id="cardFields" style="display:none;margin-top:10px">
      <input type="text" id="cardNumber" placeholder="Número do cartão"/>
      <div class="row">
        <div class="col"><input type="text" id="cardExp" placeholder="MM/AA"/></div>
        <div class="col"><input type="text" id="cardCVV" placeholder="CVV"/></div>
      </div>
      <input type="text" id="cardName" placeholder="Nome no cartão"/>
      <input type="text" id="cardCPF" placeholder="CPF (000.000.000-00)"/>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px;justify-content:center">
      <button class="btn" id="confirmDeposit">Depositar</button>
      <button class="btn btn-ghost" id="cancelDeposit">Cancelar</button>
    </div>

    <div class="small" style="margin-top:8px">
      Creditado no mesmo instante 
    </div>
  </div>
</div>


<!-- Modal Saque -->
<div class="modal" id="withdrawModal">
  <div class="modal-box">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">Solicitar Saque</h3>
      <button class="btn-ghost" id="closeWithdraw">X</button>
    </div>

    <input type="number" id="withdrawAmt" max="2000" placeholder="Valor do saque (máx R$ 2.000)"/>

    <div class="amounts">
      <div class="amount" onclick="setWithdraw(50)">R$ 50</div>
      <div class="amount" onclick="setWithdraw(100)">R$ 100</div>
      <div class="amount" onclick="setWithdraw(200)">R$ 200</div>
      <div class="amount" onclick="setWithdraw(500)">R$ 500</div>
    </div>

    <select id="withdrawType">
      <option value="corrente">Conta Corrente</option>
      <option value="poupanca">Conta Poupança</option>
      <option value="pix">PIX</option>
      <option value="salario">Conta Salário</option>
    </select>

    <input type="text" id="withdrawCPF" placeholder="CPF (000.000.000-00)"/>

    <div style="margin-top:12px;display:flex;gap:8px;justify-content:center">
      <button class="btn" id="confirmWithdraw">Confirmar</button>
      <button class="btn btn-ghost" id="cancelWithdraw">Cancelar</button>
    </div>
  </div>
</div>


<!-- Modal Login (simples) -->
<div class="modal" id="loginModal">
  <div class="modal-box">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0" id="authModalTitle">Login</h3>
      <button class="btn-ghost" id="closeLogin">X</button>
    </div>

    <div style="margin-top:12px">
      <input type="text" id="authUser" placeholder="Usuário"/>
      <input type="password" id="authPass" placeholder="Senha"/>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" id="doLogin">Entrar</button>
        <button class="btn" id="doRegister">Registrar</button>
      </div>
      <div class="small" style="margin-top:8px">Admin padrão: <strong>admin</strong> / senha <strong>admin123</strong></div>
    </div>
  </div>
</div>

<script>
/* -------------------------
   Dados / usuários (localStorage)
   ------------------------- */
let users = JSON.parse(localStorage.getItem('users')) || {};
if(!users['admin']){
  users['admin'] = { password: 'admin123', balance: 0, isAdmin: true, transactions: [] };
  localStorage.setItem('users', JSON.stringify(users));
}
let currentUser = localStorage.getItem('currentUser') || null;

/* ---------- helpers ---------- */
function saveUsers(){ localStorage.setItem('users', JSON.stringify(users)); }
function formatMoney(v){ return Number(v).toFixed(2).replace('.',','); }
function pushTransaction(user, type, amount, note){
  users[user].transactions = users[user].transactions || [];
  users[user].transactions.unshift({when:new Date().toLocaleString(), type, amount, note});
  saveUsers();
}

/* ---------- UI: ganhadores fictícios ---------- */
const fakeWinners = [
  {name:'Lucas S.', prize:'R$ 2.500', when:'há 3 min'},
  {name:'Mariana P.', prize:'R$ 500', when:'há 12 min'},
  {name:'Carlos M.', prize:'R$ 10.000', when:'há 1h'},
  {name:'Ana F.', prize:'R$ 50', when:'há 2h'},
  {name:'Rafael B.', prize:'R$ 1.200', when:'há 3h'},
  {name:'Juliana R.', prize:'R$ 5.000', when:'há 5h'},
  {name:'Pedro N.', prize:'R$ 80', when:'há 6h'},
  {name:'Bruna A.', prize:'R$ 230', when:'há 8h'},
  {name:'Felipe T.', prize:'R$ 350', when:'há 10h'},
  {name:'Clara G.', prize:'R$ 120', when:'há 12h'}
];

function renderWinners(){
  const el = document.getElementById('winnersList'); el.innerHTML='';
  fakeWinners.forEach(w=>{
    const div = document.createElement('div'); div.className='winner';
    div.innerHTML = `<div class="avatar">${w.prize.split(' ')[1] ? '💰' : 'R'}</div>
      <div>
        <div style="font-weight:700">${w.name} <span class="small">· ${w.when}</span></div>
        <div class="small">${w.prize}</div>
      </div>`;
    el.appendChild(div);
  });
}

/* ---------- jogos / grid ---------- */
const games = [
  {title:'Pix Turbinado', price:1},
  {title:'Sonho Premiado', price:2},
  {title:'Ostentação', price:5},
  {title:'Mega Black', price:10},
  {title:'Mega 50', price:50},
  {title:'Mini Rasp', price:0.5}
];

function renderGames(){
  const grid = document.getElementById('gamesGrid'); grid.innerHTML='';
  games.forEach(g=>{
    const d = document.createElement('div'); d.className='game';
    d.innerHTML = `<div style="font-weight:700">${g.title}</div>
      <div class="small">Valor: R$ ${g.price}</div>
      <div style="margin-top:8px"><button class="btn" onclick="playGame(${g.price},'${g.title}')">Comprar</button></div>`;
    grid.appendChild(d);
  });
}

/* ---------- saldo / extrato ---------- */
function updateBalanceUI(){
  if(!currentUser){ document.getElementById('balanceDisplay').textContent = 'Saldo: R$ 0.00'; return; }
  users[currentUser].balance = users[currentUser].balance || 0;
  document.getElementById('balanceDisplay').textContent = 'Saldo: R$ ' + formatMoney(users[currentUser].balance);
  renderTransactions();
  saveUsers();
}

function renderTransactions(){
  const box = document.getElementById('transactionsList');
  box.innerHTML = '';
  if(!currentUser || !users[currentUser].transactions) return;
  users[currentUser].transactions.slice(0,30).forEach(t=>{
    const el = document.createElement('div');
    el.style.padding='6px 0'; el.style.borderBottom='1px solid rgba(255,255,255,0.02)';
    el.innerHTML = `<div style="font-weight:700">${t.type} — R$ ${formatMoney(t.amount)}</div><div class="small">${t.when} — ${t.note || ''}</div>`;
    box.appendChild(el);
  });
}

/* ---------- depositos / modal ---------- */
const depositModal = document.getElementById('depositModal');
const loginModal = document.getElementById('loginModal');

document.getElementById('openDepositBtn').addEventListener('click', ()=>{
  if(!currentUser){ openLogin(); return; }
  depositModal.classList.add('active');
});
document.getElementById('closeDeposit').addEventListener('click', ()=> depositModal.classList.remove('active'));
document.getElementById('cancelDeposit').addEventListener('click', ()=> depositModal.classList.remove('active'));

function setDeposit(v){ document.getElementById('depositAmt').value = v; }
function quickDeposit(v){
  if(!currentUser){ alert('Faça login para depositar.'); openLogin(); return; }
  users[currentUser].balance = (users[currentUser].balance || 0) + v;
  pushTransaction(currentUser,'Depósito',v,'Depósito rápido');
  updateBalanceUI();
  alert('Depósito de R$ ' + v + ' realizado .');
}

/* tabs pix/card */
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click',(ev)=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    ev.currentTarget.classList.add('active');
    const method = ev.currentTarget.dataset.method;
    document.getElementById('cardFields').style.display = (method==='card') ? 'block' : 'none';
  });
});

document.getElementById('confirmDeposit').addEventListener('click', ()=> {
  if(!currentUser){ alert('Faça login para depositar.'); depositModal.classList.remove('active'); openLogin(); return; }
  const val = parseFloat(document.getElementById('depositAmt').value);
  if(isNaN(val) || val <= 0){ alert('Digite um valor válido.'); return; }
  if(val > 2000){ alert('O limite de depósito é R$ 2.000.'); return; }
  // se cartão, checar campos 
  const method = document.querySelector('.tab.active').dataset.method;
  if(method === 'card'){
    const num = document.getElementById('cardNumber').value.trim();
    const name = document.getElementById('cardName').value.trim();
    if(!num || !name){ alert('Preencha os dados do cartão válido.'); return; }
  }
  users[currentUser].balance = (users[currentUser].balance || 0) + val;
  pushTransaction(currentUser,'Depósito',val,'Via ' + method);
  updateBalanceUI();
  depositModal.classList.remove('active');
  alert('Depósito de R$ ' + val + ' realizado.');
});

/* ---------- saque ---------- */

function withdrawFlow(){
  if(!currentUser){ alert('Faça login para sacar.'); openLogin(); return; }
  document.getElementById('withdrawModal').classList.add('active');
}
function setWithdraw(v){ document.getElementById('withdrawAmt').value = v; }
document.getElementById('closeWithdraw').addEventListener('click', ()=> 
  document.getElementById('withdrawModal').classList.remove('active')
);
document.getElementById('cancelWithdraw').addEventListener('click', ()=> 
  document.getElementById('withdrawModal').classList.remove('active')
);
document.getElementById('confirmWithdraw').addEventListener('click', ()=>{
  const val = parseFloat(document.getElementById('withdrawAmt').value);
  const tipoConta = document.getElementById('withdrawType').value;
  const cpf = document.getElementById('withdrawCPF').value.trim();
  if(isNaN(val) || val <= 0){ alert('Digite um valor válido.'); return; }
  if(val > 2000){ alert('O limite de saque é R$ 2.000.'); return; }
  if(val > (users[currentUser].balance || 0)){ alert('Saldo insuficiente.'); return; }
  if(!cpf){ alert('Informe o CPF.'); return; }
  users[currentUser].balance -= val;
  pushTransaction(currentUser,'Saque',val,`Saque via ${tipoConta}`);
  updateBalanceUI();
  document.getElementById('withdrawModal').classList.remove('active');
  alert(`Saque de R$ ${val} solicitado via ${tipoConta}.`);
});


/* ---------- jogos / compra ---------- */
function playGame(price, title){
  if(!currentUser){ alert('Faça login para jogar.'); openLogin(); return; }
  if((users[currentUser].balance || 0) < price){ alert('Saldo insuficiente.'); return; }
  users[currentUser].balance -= price;
  pushTransaction(currentUser,'Compra',price,'Compra de '+title);
  updateBalanceUI();
  alert('Você comprou ' + title + ' por R$ ' + price + ' .');
}

/* ---------- raspadinha (canvas) ---------- */
const scratchCanvas = document.getElementById('scratchCanvas');
const ticketPrize = document.getElementById('ticketPrize');
let scCtx, drawing=false;
function setupScratch(){
  scratchCanvas.width = scratchCanvas.clientWidth * devicePixelRatio;
  scratchCanvas.height = scratchCanvas.clientHeight * devicePixelRatio;
  scratchCanvas.style.width = scratchCanvas.clientWidth + 'px';
  scratchCanvas.style.height = scratchCanvas.clientHeight + 'px';
  scCtx = scratchCanvas.getContext('2d');
  scCtx.scale(devicePixelRatio,devicePixelRatio);
  resetScratch();
}
function resetScratch(){
  scCtx.globalCompositeOperation = 'source-over';
  scCtx.fillStyle = '#b0b0b0';
  scCtx.fillRect(0,0,scratchCanvas.clientWidth,scratchCanvas.clientHeight);
  scCtx.globalCompositeOperation = 'destination-out';
}
scratchCanvas.addEventListener('mousedown', ()=> drawing=true);
window.addEventListener('mouseup', ()=> drawing=false);
scratchCanvas.addEventListener('mousemove', (e)=>{
  if(!drawing) return;
  const rect = scratchCanvas.getBoundingClientRect();
  const x = (e.clientX - rect.left);
  const y = (e.clientY - rect.top);
  scCtx.beginPath(); scCtx.arc(x,y,16,0,Math.PI*2); scCtx.fill();
});
document.getElementById('resetScratch').addEventListener('click', resetScratch);

/* botão jogar raspadinha: cobra e dá premio aleatorio (demo) */
document.getElementById('playRasp').addEventListener('click', ()=>{
  if(!currentUser){ alert('Faça login para jogar.'); openLogin(); return; }
  const cost = 10;
  if((users[currentUser].balance || 0) < cost){ alert('Saldo insuficiente.'); return; }
  users[currentUser].balance -= cost;
  // premio aleatório (demo)
  const winChance = Math.random();
  let prize = 0;
  if(winChance > 0.9) prize = 100;
  else if(winChance > 0.7) prize = 50;
  else if(winChance > 0.4) prize = 20;
  else prize = 0;
  if(prize>0){
    users[currentUser].balance += prize;
    pushTransaction(currentUser,'Raspada',prize,'Ganhou R$ '+prize);
    // adicionar à lista de ganhadores ficticios (visual)
    fakeWinners.unshift({name:currentUser, prize:'R$ '+prize, when:'agora'});
    if(fakeWinners.length>30) fakeWinners.pop();
    renderWinners();
    ticketPrize.textContent = 'R$ ' + prize;
    alert('Parabéns! Você ganhou R$ ' + prize + ' .');
  } else {
    pushTransaction(currentUser,'Raspada',0,'Sem prêmio');
    ticketPrize.textContent = 'R$ 0';
    alert('Não foi dessa vez. Tente outra! .');
  }
  updateBalanceUI();
  resetScratch();
});

/* ---------- login modal ---------- */
function openLogin(){
  loginModal.classList.add('active');
  document.getElementById('authModalTitle').textContent = 'Login / Registrar';
}
document.getElementById('openLoginBtn').addEventListener('click', openLogin);
document.getElementById('closeLogin').addEventListener('click', ()=> loginModal.classList.remove('active'));
document.getElementById('doLogin').addEventListener('click', ()=> {
  const u = document.getElementById('authUser').value.trim();
  const p = document.getElementById('authPass').value;
  if(!u || !p){ alert('Preencha usuário e senha'); return; }
  if(users[u] && users[u].password === p){
    currentUser = u; localStorage.setItem('currentUser', currentUser);
    loginModal.classList.remove('active');
    afterLogin();
  } else {
    alert('Usuário ou senha incorretos');
  }
});
document.getElementById('doRegister').addEventListener('click', ()=> {
  const u = document.getElementById('authUser').value.trim();
  const p = document.getElementById('authPass').value;
  if(!u || !p){ alert('Preencha usuário e senha'); return; }
  if(users[u]){ alert('Usuário já existe'); return; }
  users[u] = { password: p, balance: 0, transactions: [] };
  saveUsers();
  alert('Registrado com sucesso! Faça login.'); renderRegisteredUsers();
});

/* ---------- ADMIN PANEL ---------- */
function isAdmin(){ return currentUser && users[currentUser] && users[currentUser].isAdmin; }

function renderAdmin(){
  const container = document.getElementById('adminContainer'); container.innerHTML = '';
  if(!isAdmin()) return;
  const panel = document.createElement('div'); panel.className='card admin-card';
  panel.innerHTML = `
    <h3>Admin • Gerenciar</h3>
    <div class="small">Creditar / Debitar usuários</div>
    <input id="adminUser" placeholder="Usuário"/>
    <input id="adminValue" placeholder="Valor (ex: 50)"/>
    <div style="margin-top:8px">
      <button class="btn" onclick="adminCredit()">Creditar</button>
      <button class="btn" onclick="adminDebit()">Debitar</button>
      <button class="btn" onclick="adminPromote()">Promover</button>
      <button class="btn btn-danger" onclick="adminReset()">Zerar saldo</button>
    </div>
    <div style="margin-top:10px"><strong class="small">Histórico (admin)</strong><div id="adminHistBox" style="max-height:120px;overflow:auto;margin-top:6px;font-size:13px"></div></div>
  `;
  container.appendChild(panel);
  renderAdminHistory();
  // Render registered users list
  const usersListDiv = document.createElement('div');
  usersListDiv.style.marginTop = '10px';
  usersListDiv.innerHTML = '<strong class="small">Usuários registrados</strong><div id="usersListBox" style="max-height:120px;overflow:auto;margin-top:6px;font-size:13px"></div>';
  container.appendChild(usersListDiv);
  renderRegisteredUsers();
}

function adminMsg(text){
  alert(text);
}

function adminCredit(){
  const u = document.getElementById('adminUser').value.trim();
  const v = parseFloat(document.getElementById('adminValue').value);
  if(!u || isNaN(v) || v<=0){ adminMsg('Usuário ou valor inválido'); return; }
  if(!users[u]){ adminMsg('Usuário não encontrado'); return; }
  users[u].balance = (users[u].balance||0) + v;
  pushTransaction(u,'AdminCred',v,'Crédito por admin '+currentUser);
  saveUsers(); renderAdminHistory(); updateBalanceUI();
  adminMsg('Credited R$ '+v+' to '+u); renderRegisteredUsers();
}

function adminDebit(){
  const u = document.getElementById('adminUser').value.trim();
  const v = parseFloat(document.getElementById('adminValue').value);
  if(!u || isNaN(v) || v<=0){ adminMsg('Usuário ou valor inválido'); return; }
  if(!users[u]){ adminMsg('Usuário não encontrado'); return; }
  users[u].balance = Math.max(0,(users[u].balance||0) - v);
  pushTransaction(u,'AdminDeb',v,'Débito por admin '+currentUser);
  saveUsers(); renderAdminHistory(); updateBalanceUI();
  adminMsg('Debited R$ '+v+' from '+u); renderRegisteredUsers();
}

function adminPromote(){
  const u = document.getElementById('adminUser').value.trim();
  if(!u || !users[u]){ adminMsg('Usuário inválido'); return; }
  users[u].isAdmin = true;
  saveUsers(); renderAdminHistory(); adminMsg(u+' promovido a admin'); renderRegisteredUsers();
}

function adminReset(){
  const u = document.getElementById('adminUser').value.trim();
  if(!u || !users[u]){ adminMsg('Usuário inválido'); return; }
  users[u].balance = 0;
  pushTransaction(u,'AdminReset',0,'Reset por '+currentUser);
  saveUsers(); renderAdminHistory(); updateBalanceUI();
  adminMsg('Saldo zerado de '+u); renderRegisteredUsers();
}

function renderAdminHistory(){
  const box = document.getElementById('adminHistBox');
  if(!box) return;
  const hist = JSON.parse(localStorage.getItem('adminHistory') || '[]');
  box.innerHTML = hist.map(h=>`<div style="padding:6px;border-bottom:1px solid rgba(255,255,255,0.02)">${h.when} — <strong>${h.by}</strong>: ${h.action}</div>`).join('');
}

function registerAdminAction(action){
  const key = 'adminHistory';
  const hist = JSON.parse(localStorage.getItem(key) || '[]');
  hist.unshift({when:new Date().toLocaleString(), by:currentUser, action});
  localStorage.setItem(key, JSON.stringify(hist));
  renderAdminHistory();
}


function renderRegisteredUsers(){
  const box = document.getElementById('usersListBox'); if(!box) return;
  const keys = Object.keys(users || {});
  if(keys.length===0){ box.innerHTML = '<div class="small">Nenhum usuário registrado.</div>'; return; }
  box.innerHTML = keys.map(u => {
    const bal = (users[u].balance||0).toFixed(2);
    return `<div style="padding:6px;border-bottom:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center"><div><strong>${u}</strong><div class="small">Saldo: R$ ${bal}</div></div><div><button class='btn' onclick="document.getElementById('adminUser').value='${u}';document.getElementById('adminValue').focus();">Selecionar</button></div></div>`;
  }).join('');
}

/* ---------- após login ---------- */
function afterLogin(){
  document.getElementById('openLoginBtn').textContent = currentUser;
  document.getElementById('openDepositBtn').textContent = 'Depositar';
  renderWinners(); renderGames();
  updateBalanceUI();
  renderAdmin();
  // registrar sessão atual
  localStorage.setItem('currentUser', currentUser);
}

/* ---------- init ---------- */
renderWinners(); renderGames();
setupScratch();
if(currentUser){ afterLogin(); updateBalanceUI(); }

/* ---------- auto-login form small: allow clicking header login to open modal (if not logged) ---------- */
document.getElementById('openLoginBtn').addEventListener('click', ()=>{
  if(currentUser){ if(confirm('Deseja sair do usuário atual?')){ currentUser=null; localStorage.removeItem('currentUser'); location.reload(); } return; }
  openLogin();
});

/* register admin actions for credit/debit/promote */
const originalAdminCredit = adminCredit;
const originalAdminDebit = adminDebit;
const originalAdminPromote = adminPromote;
const originalAdminReset = adminReset;
/* wrap to register history */
adminCredit = function(){ originalAdminCredit(); registerAdminAction('credit'); };
adminDebit = function(){ originalAdminDebit(); registerAdminAction('debit'); };
adminPromote = function(){ originalAdminPromote(); registerAdminAction('promote'); };
adminReset = function(){ originalAdminReset(); registerAdminAction('reset'); };

</script>
</body>
</html>
    
  </body>
  
</html>
